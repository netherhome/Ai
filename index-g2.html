<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>GarticTwo Online</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>
<body class="bg-gray-900 text-white font-sans flex flex-col items-center min-h-screen">

  <!-- Header -->
  <header class="w-full bg-gray-800 py-4 shadow-lg flex justify-between px-6 items-center">
    <h1 class="text-2xl font-bold text-indigo-400">GarticTwo Online</h1>
    <nav class="space-x-4">
      <button id="newGameBtn" class="px-4 py-2 bg-indigo-500 rounded-lg hover:bg-indigo-600">New Game</button>
      <button id="joinGameBtn" class="px-4 py-2 bg-green-500 rounded-lg hover:bg-green-600">Join Game</button>
    </nav>
  </header>

  <!-- Lobby -->
  <main id="lobby" class="flex flex-col items-center mt-10 w-full max-w-3xl">
    <h2 class="text-xl mb-4">Lobby</h2>
    <input id="nickname" placeholder="Enter your name" class="px-4 py-2 rounded-lg text-black mb-3 w-full"/>
    <input id="roomCode" placeholder="Room Code" class="px-4 py-2 rounded-lg text-black mb-3 w-full"/>
    <button id="createRoom" class="px-6 py-2 bg-indigo-500 rounded-lg hover:bg-indigo-600 mb-3">Create Room</button>
    <button id="joinRoom" class="px-6 py-2 bg-green-500 rounded-lg hover:bg-green-600">Join Room</button>
    <ul id="playersList" class="mt-6 space-y-2"></ul>
  </main>

  <!-- Game Area -->
  <section id="gameArea" class="hidden w-full max-w-6xl mt-10 flex flex-col">
    <h2 class="text-xl mb-4 text-center">Game</h2>
    <div class="flex flex-col md:flex-row gap-6">
      <!-- Drawing Canvas -->
      <div class="bg-gray-800 p-4 rounded-xl shadow-xl flex-1">
        <canvas id="drawingCanvas" width="600" height="400" class="border-2 border-gray-700 rounded"></canvas>
        <div class="flex mt-2 gap-2">
          <button id="toolSmall" class="px-2 py-1 bg-gray-700 rounded">‚úèÔ∏è Small</button>
          <button id="toolBig" class="px-2 py-1 bg-gray-700 rounded">üñåÔ∏è Big</button>
          <button id="toolEraser" class="px-2 py-1 bg-gray-700 rounded">ü©π Eraser</button>
          <input type="color" id="colorPicker" class="w-10 h-10 rounded border"/>
          <button id="clearCanvas" class="px-3 py-1 bg-red-500 rounded hover:bg-red-600">Clear</button>
        </div>
      </div>

      <!-- Chat -->
      <div class="flex-1 flex flex-col bg-gray-800 p-4 rounded-xl shadow-xl">
        <div class="flex-1 overflow-y-auto mb-3" id="chatBox"></div>
        <input id="chatInput" placeholder="Type message..." class="px-3 py-2 text-black rounded w-full"/>
      </div>
    </div>
  </section>

  <script>
    // ================= Firebase Setup =================
    const firebaseConfig = {
      apiKey: "AIzaSyBnxa5QbhfrD_8LTrZbrmjI5wVRKHSXGLg",
      authDomain: "gartictwo.firebaseapp.com",
      databaseURL: "https://gartictwo-default-rtdb.firebaseio.com", // ‚úÖ required
      projectId: "gartictwo",
      storageBucket: "gartictwo.firebasestorage.app",
      messagingSenderId: "602694382683",
      appId: "1:602694382683:web:1dc11cb6b715944ba0fb7e"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let playerName = "";
    let roomCode = "";
    let isHost = false;

    const lobby = document.getElementById("lobby");
    const gameArea = document.getElementById("gameArea");
    const nicknameInput = document.getElementById("nickname");
    const roomInput = document.getElementById("roomCode");
    const playersList = document.getElementById("playersList");
    const chatBox = document.getElementById("chatBox");
    const chatInput = document.getElementById("chatInput");

    // CREATE ROOM
    document.getElementById("createRoom").onclick = () => {
      playerName = nicknameInput.value.trim();
      if (!playerName) return alert("Enter a name first!");

      roomCode = Math.random().toString(36).substring(2,6).toUpperCase();
      isHost = true;

      db.ref("rooms/" + roomCode).set({
        host: playerName,
        players: { [playerName]: true },
        chat: []
      }).then(() => {
        joinRoom(roomCode, playerName);
        alert("Room created! Code: " + roomCode);
      }).catch(err => alert("Error: " + err.message));
    };

    // JOIN ROOM
    document.getElementById("joinRoom").onclick = () => {
      playerName = nicknameInput.value.trim();
      roomCode = roomInput.value.trim().toUpperCase();
      if (!playerName || !roomCode) return alert("Enter both name and room code!");

      joinRoom(roomCode, playerName);
    };

    function joinRoom(code, name) {
      db.ref("rooms/" + code + "/players/" + name).set(true);

      lobby.classList.add("hidden");
      gameArea.classList.remove("hidden");

      // Update player list
      db.ref("rooms/" + code + "/players").on("value", snap => {
        playersList.innerHTML = "";
        if (snap.val()) {
          Object.keys(snap.val()).forEach(p => {
            let li = document.createElement("li");
            li.textContent = p;
            playersList.appendChild(li);
          });
        }
      });

      // Listen for chat
      db.ref("rooms/" + code + "/chat").on("child_added", snap => {
        let { name, msg } = snap.val();
        let div = document.createElement("div");
        div.innerHTML = `<b class="text-indigo-400">${name}:</b> ${msg}`;
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;
      });
    }

    // Chat send
    chatInput.addEventListener("keypress", e => {
      if (e.key === "Enter" && chatInput.value.trim() !== "") {
        db.ref("rooms/" + roomCode + "/chat").push({ name: playerName, msg: chatInput.value });
        chatInput.value = "";
      }
    });

    // ================= Drawing =================
    const canvas = document.getElementById("drawingCanvas");
    const ctx = canvas.getContext("2d");
    let drawing = false;
    let brushSize = 5;
    let brushColor = "#000000";
    let eraser = false;

    canvas.addEventListener("mousedown", () => drawing = true);
    canvas.addEventListener("mouseup", () => drawing = false);
    canvas.addEventListener("mouseout", () => drawing = false);
    canvas.addEventListener("mousemove", draw);

    function draw(e) {
      if (!drawing) return;
      ctx.fillStyle = eraser ? "#ffffff" : brushColor;
      ctx.beginPath();
      ctx.arc(e.offsetX, e.offsetY, brushSize, 0, Math.PI * 2);
      ctx.fill();
      // TODO: sync strokes via Firebase for multiplayer drawing
    }

    document.getElementById("colorPicker").oninput = e => {
      brushColor = e.target.value;
      eraser = false;
    };
    document.getElementById("toolSmall").onclick = () => { brushSize = 3; eraser = false; };
    document.getElementById("toolBig").onclick = () => { brushSize = 15; eraser = false; };
    document.getElementById("toolEraser").onclick = () => { eraser = true; brushSize = 10; };
    document.getElementById("clearCanvas").onclick = () => ctx.clearRect(0, 0, canvas.width, canvas.height);

    // ================= Game Modes (scaffold) =================
    // Regular, Icebreaker, Masterpiece, Story
    // TODO: Add turn logic & storyline recap
  </script>
</body>
</html>
