<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>HyphonChat</title>
<style>
:root{
--bg-dark:#111;
--text-dark:#eee;
--bg-light:#f5f5f5;
--text-light:#111;
}
body{
  font-family:'Segoe UI',sans-serif;
  margin:0;padding:0;
  background: var(--bg-dark);
  color: var(--text-dark);
}
#startup,#chatUI{position:fixed;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;}
#startup input,#startup select,#startup button,#startup textarea{padding:10px;margin:5px;border-radius:8px;border:none;font-size:16px;}
#chatContainer{display:none;max-width:900px;width:100%;margin:0 auto;padding:20px;flex:1;display:flex;flex-direction:column;}
#chatList{display:flex;gap:10px;margin-bottom:10px;}
.chatItem{padding:5px 10px;background:#333;border-radius:8px;cursor:pointer;}
#chat{border:1px solid #444;padding:10px;height:400px;overflow-y:auto;border-radius:12px;background:#222;flex:1;display:flex;flex-direction:column;}
textarea{width:80%;height:50px;padding:10px;border-radius:8px;border:1px solid #555;margin-top:10px;resize:none;}
button{padding:10px 15px;border:none;border-radius:8px;margin-left:5px;cursor:pointer;}
.userBubble{padding:8px 12px;border-radius:15px;margin:5px 0;max-width:70%;word-wrap:break-word;align-self:flex-end;color:#fff;}
.friendBubble{padding:8px 12px;border-radius:15px;margin:5px 0;max-width:70%;word-wrap:break-word;align-self:flex-start;color:#fff;}
.typing{font-style:italic;opacity:0.6;}
#toggleMode{position:absolute;top:10px;right:10px;padding:5px 10px;border-radius:6px;}
</style>
</head>
<body>

<div id="startup">
  <h1>Welcome to HyphonChat!</h1>
  <input type="text" id="nameInput" placeholder="Enter your name"/>
  <select id="colorSelect">
    <option value="#1abc9c">Teal</option>
    <option value="#e67e22">Orange</option>
    <option value="#3498db">Blue</option>
    <option value="#9b59b6">Purple</option>
    <option value="#e74c3c">Red</option>
    <option value="#f1c40f">Yellow</option>
    <option value="#2ecc71">Green</option>
    <option value="#e84393">Pink</option>
    <option value="#fff">White</option>
  </select>
  <div>
    <button onclick="setMode('light')">Light Mode</button>
    <button onclick="setMode('dark')">Dark Mode</button>
  </div>
  <div style="margin-top:10px;">
    <button onclick="startChatUI()">Start Chat</button>
  </div>
</div>

<div id="chatUI">
  <button id="toggleMode" onclick="toggleMode()">Toggle Light/Dark</button>
  <div id="chatList"></div>
  <div id="chat"></div>
  <textarea id="msg" placeholder="Type a message..."></textarea>
  <button onclick="sendMessage()">Send</button>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

<script>
// ===== Firebase config =====
const firebaseConfig = {
  apiKey: "AIzaSyCSh6K8e_CAswGyYuIvgMVKZ3T8b5gGKFU",
  authDomain: "hyphonchat.firebaseapp.com",
  databaseURL: "https://hyphonchat-default-rtdb.firebaseio.com",
  projectId: "hyphonchat",
  storageBucket: "hyphonchat.firebasestorage.app",
  messagingSenderId: "172774813412",
  appId: "1:172774813412:web:8d307b6a170bf270cfc6f1"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ===== Variables =====
let myName="", myColor="#1abc9c", isDark=true;
let currentChat=null;
const maxMessages=40;
const chatDiv=document.getElementById("chat");
const chatListDiv=document.getElementById("chatList");

// ===== Light/Dark mode =====
function setMode(mode){
  isDark = mode==="dark";
  document.body.style.background = isDark? "#111":"#f5f5f5";
  document.body.style.color = isDark? "#eee":"#111";
  document.getElementById("chat").style.background = isDark? "#222":"#ddd";
}
function toggleMode(){ setMode(isDark?"light":"dark"); }

// ===== Startup =====
function startChatUI(){
  const nameVal=document.getElementById("nameInput").value.trim();
  myName = nameVal||("User"+Math.floor(Math.random()*1000));
  myColor=document.getElementById("colorSelect").value;
  document.getElementById("startup").style.display="none";
  document.getElementById("chatUI").style.display="flex";
  loadChatList();
}

// ===== Chat List & Group Chats =====
function loadChatList(){
  chatListDiv.innerHTML="";
  db.ref("chats").once("value").then(snap=>{
    snap.forEach(child=>{
      const c=child.key;
      const chatName = child.val().name||c;
      const div=document.createElement("div");
      div.className="chatItem";
      div.textContent=chatName;
      div.onclick=()=>joinChat(c);
      chatListDiv.appendChild(div);
    });
    // Buttons
    const createBtn=document.createElement("div");
    createBtn.className="chatItem";
    createBtn.textContent="Create Chat";
    createBtn.onclick=createChat;
    chatListDiv.appendChild(createBtn);

    const joinBtn=document.createElement("div");
    joinBtn.className="chatItem";
    joinBtn.textContent="Join Chat";
    joinBtn.onclick=joinChatPrompt;
    chatListDiv.appendChild(joinBtn);
  });
}

// ===== Join/Create Chat =====
function joinChatPrompt(){
  const code=prompt("Enter 5-digit chat code:");
  if(code) joinChat(code);
}
function createChat(){
  const code=Math.floor(10000+Math.random()*90000).toString();
  const name=prompt("Enter chat name (optional)","New Chat")||"New Chat";
  db.ref("chats/"+code).set({name});
  joinChat(code);
}

// ===== Join Chat =====
function joinChat(chatCode){
  currentChat=chatCode;
  chatDiv.innerHTML="";
  listenMessages();
}

// ===== Listen messages =====
function listenMessages(){
  if(!currentChat) return;
  db.ref("messages/"+currentChat).on("child_added",snap=>{
    const data=snap.val();
    addMessageBubble(data.user,data.text,data.color,data.user===myName);
    pruneMessages();
  });
}

// ===== Add message =====
function addMessageBubble(user,text,color,isMe){
  const div=document.createElement("div");
  div.className=isMe?"userBubble":"friendBubble";
  div.textContent=user+": "+text;
  div.style.background = isMe? color : color||"#444";
  chatDiv.appendChild(div);
  chatDiv.scrollTop=99999;
}

// ===== Send message =====
function sendMessage(){
  const txt=document.getElementById("msg").value.trim();
  if(!txt || !currentChat) return;
  db.ref("messages/"+currentChat).push({user:myName,text:txt,color:myColor});
  document.getElementById("msg").value="";
}

// ===== Prune old messages =====
function pruneMessages(){
  db.ref("messages/"+currentChat).once("value").then(snap=>{
    if(snap.numChildren()>maxMessages){
      const keys=Object.keys(snap.val()).sort();
      const del=keys.slice(0,snap.numChildren()-maxMessages);
      del.forEach(k=>db.ref("messages/"+currentChat+"/"+k).remove());
    }
  });
}

// ===== Initial mode =====
setMode("dark");
</script>
</body>
</html>
