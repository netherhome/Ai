<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>HyphonChat Deluxe</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
body{margin:0;font-family:'Inter',sans-serif;background:#0f0f0f;color:#eee;height:100vh;display:flex;flex-direction:column;}
header{display:flex;justify-content:space-between;align-items:center;padding:10px;background:linear-gradient(135deg,#1abc9c,#3498db);box-shadow:0 4px 10px rgba(0,0,0,0.5);border-bottom-left-radius:12px;border-bottom-right-radius:12px;}
header button{margin:0 4px;padding:8px 14px;border:none;border-radius:8px;cursor:pointer;background:linear-gradient(135deg,#f1c40f,#e67e22);color:#fff;font-weight:600;transition:0.2s;}
header button:hover{filter:brightness(1.1);}
#chatUI{flex:1;display:none;flex-direction:column;}
#chatContainer{flex:1;display:flex;flex-direction:column;padding:12px;}
#chat{flex:1;overflow-y:auto;background:#1a1a1a;border-radius:12px;padding:12px;display:flex;flex-direction:column;gap:6px;scroll-behavior:smooth;}
#chatContainer textarea{border:none;border-radius:8px;padding:10px;margin-top:8px;resize:none;background:linear-gradient(135deg,#1abc9c,#3498db);color:#fff;font-weight:bold;}
#chatContainer button#sendBtn{background:linear-gradient(135deg,#f1c40f,#e67e22);color:#fff;font-weight:600;}
button{border:none;border-radius:6px;padding:6px 12px;cursor:pointer;margin:2px;}
.bub{max-width:90%;padding:10px 14px;border-radius:16px;word-wrap:break-word;box-shadow:0 2px 5px rgba(0,0,0,0.4);}
.me{align-self:flex-end;}
.them{align-self:flex-start;}
.name{font-size:12px;font-weight:600;margin:0 0 2px 0;color:#ccc;}
.time{font-size:10px;color:#aaa;margin-left:6px;}
.pfp{width:36px;height:36px;border-radius:50%;object-fit:cover;flex-shrink:0;box-shadow:0 2px 4px rgba(0,0,0,0.5);}
.msgRow{display:flex;align-items:flex-start;gap:8px;}
.msgRow.me{flex-direction:row-reverse;}
.join{font-style:italic;color:#aaa;font-size:12px;text-align:center;margin:4px 0;}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);align-items:center;justify-content:center;z-index:50;}
.modalContent{background:linear-gradient(135deg,#1abc9c,#3498db);color:#fff;padding:18px;border-radius:12px;min-width:280px;max-height:80%;overflow:auto;box-shadow:0 4px 12px rgba(0,0,0,0.7);}
.modalContent h3{background:linear-gradient(135deg,#1abc9c,#3498db);padding:8px;border-radius:8px;margin-top:0;margin-bottom:8px;text-align:center;}
.modalContent input{padding:8px;margin:6px 0;border-radius:6px;border:none;width:90%;}
.modalContent button{background:linear-gradient(135deg,#f1c40f,#e67e22);color:#fff;font-weight:600;margin:4px;}
.friendItem{display:flex;align-items:center;gap:6px;padding:4px 0;cursor:pointer;}
.friendItem:hover{background:rgba(255,255,255,0.05);border-radius:6px;}
#startupScreen{position:fixed;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;background:linear-gradient(135deg,#1abc9c,#3498db);color:#fff;z-index:1000;}
#startupScreen h1{font-size:2.5em;margin-bottom:20px;}
</style>
</head>
<body>

<script>
<!-- Startup Screen -->
<div id="startupScreen">
  <h1>Welcome to Hyphon Chat</h1>
  <div>
    <button id="signupBtn" style="background:linear-gradient(135deg,#f1c40f,#e67e22);color:#fff;font-weight:600;">Sign Up for Free</button>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script>
// Firebase init
const fb={apiKey:"...",authDomain:"...",databaseURL:"...",projectId:"...",storageBucket:"...",messagingSenderId:"...",appId:"..."};
firebase.initializeApp(fb);
const db=firebase.database();

// Global vars
let me="";

// Full accUI function must be defined here:
function accUI(type){
    const accModal=document.getElementById("accModal");
    const accBox=document.getElementById("accBox");
    const switchText = type==="Create" ?
      `<button onclick="accUI('Open')" style="background:linear-gradient(135deg,#f1c40f,#e67e22);color:#fff;margin-top:6px;">Already have an account? Log In</button>` :
      `<button onclick="accUI('Create')" style="background:linear-gradient(135deg,#f1c40f,#e67e22);color:#fff;margin-top:6px;">Don't have an account? Sign Up</button>`;
    
    accBox.innerHTML = `
      <h3>${type} Account</h3>
      <input id="accName" placeholder="Name">
      <input id="accPass" type="password" placeholder="Password">
      <button onclick="subAcc('${type}')" style="background:linear-gradient(135deg,#f1c40f,#e67e22);color:#fff;font-weight:600;">Submit</button>
      ${switchText}
      <button onclick="accModal.style.display='none'" style="background:linear-gradient(135deg,#f1c40f,#e67e22);color:#fff;font-weight:600;">X</button>
    `;
    accModal.style.display="flex";
}

// Attach click after DOM is ready
document.addEventListener("DOMContentLoaded", ()=>{
    document.getElementById("signupBtn").addEventListener("click",()=>{
        accUI('Create'); 
        document.getElementById("startupScreen").style.display="none";
    });
});

// Account submit function (simplified)
function subAcc(type){
    const n = document.getElementById("accName").value.trim();
    const p = document.getElementById("accPass").value;
    if(!n) return alert("Enter name");
    db.ref("users/"+n).get().then(s=>{
        if(type=="Create"){
            if(s.exists()) return alert("Name taken!");
            me=n;
            db.ref("users/"+n).set({color:"#1abc9c",password:p||null,pfp:"defaultURL"});
            alert("Account created!"); 
            document.getElementById("accModal").style.display="none";
        } else {
            if(!s.exists()) return alert("Name not found!");
            if(s.val().password && s.val().password!==p) return alert("Incorrect password!");
            me=n;
            alert("Logged in!"); 
            document.getElementById("accModal").style.display="none";
        }
    });
}



<header>
<div>
<button id="accBtn">Account</button>
<button id="chatsBtn">My Chats</button>
<button id="newChatBtn">New Chat</button>
<button id="leaveBtn">Leave Chat</button>
<button id="dmsBtn">DMs</button>
</div>
</header>

<div id="chatUI">
<div id="chatContainer">
<div id="chat"></div>
<textarea id="msg" placeholder="Type..."></textarea>
<button id="sendBtn">Send</button>
<div id="typingDiv" style="font-size:12px;color:#aaa;margin-top:4px;"></div>
</div>
</div>

<!-- Modals -->
<div id="accModal" class="modal"><div class="modalContent" id="accBox"></div></div>
<div id="chatsModal" class="modal"><div class="modalContent"><h3>My Chats</h3><div id="chatList"></div><button onclick="cls('chatsModal')">X</button></div></div>
<div id="newModal" class="modal"><div class="modalContent"><button onclick="mkChat()">Create Chat</button><button onclick="jnChat()">Join Chat</button><button onclick="cls('newModal')">X</button></div></div>
<div id="mkModal" class="modal"><div class="modalContent"><input id="mkName" placeholder="Chat name"><button onclick="subMk()">Go</button><button onclick="cls('mkModal')">X</button></div></div>
<div id="jnModal" class="modal"><div class="modalContent"><input id="jnCode" placeholder="Chat code"><button onclick="subJn()">Go</button><button onclick="cls('jnModal')">X</button></div></div>
<div id="friendReqModal" class="modal"><div class="modalContent"><h3>Friend Requests</h3><div id="friendRequests"></div><button onclick="cls('friendReqModal')">X</button></div></div>
<div id="dmsModal" class="modal"><div class="modalContent"><h3>DMs</h3><div id="dmsList"></div><button onclick="cls('dmsModal')">X</button></div></div>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script>
// Firebase
const fb={apiKey:"AIzaSyCSh6K8e_CAswGyYuIvgMVKZ3T8b5gGKFU",authDomain:"hyphonchat.firebaseapp.com",databaseURL:"https://hyphonchat-default-rtdb.firebaseio.com",projectId:"hyphonchat",storageBucket:"hyphonchat.firebasestorage.app",messagingSenderId:"172774813412",appId:"1:172774813412:web:8d307b6a170bf270cfc6f1"};
firebase.initializeApp(fb);
const db=firebase.database();

// Vars
let me="",col="#1abc9c",pic="https://th.bing.com/th/id/OIP.Xx93W3aTtFensmWsSFuDYAHaHa?w=202&h=202&c=7&r=0&o=7&dpr=1.3&pid=1.7&rm=3",chat=null,listener=null,lastUser="",lastTime=0,typingTimeout;
const chatDiv=document.getElementById("chat");
const accModal=document.getElementById("accModal");
const accBox=document.getElementById("accBox");

const cls=id=>document.getElementById(id).style.display="none";

// Startup button
document.getElementById("signupBtn").onclick = () => accUI("Create");

// Account modal UI with toggle for login/signup
function accUI(type){
  let switchText = type==="Create"?
    `<button onclick="accUI('Open')" style="background:linear-gradient(135deg,#f1c40f,#e67e22);color:#fff;margin-top:6px;">Already have an account? Log In</button>`:
    `<button onclick="accUI('Create')" style="background:linear-gradient(135deg,#f1c40f,#e67e22);color:#fff;margin-top:6px;">Don't have an account? Sign Up</button>`;
    
  accBox.innerHTML = `
    <h3>${type} Account</h3>
    <input id="accName" placeholder="Name">
    <input id="accPass" type="password" placeholder="Password">
    <button onclick="subAcc('${type}')" style="background:linear-gradient(135deg,#f1c40f,#e67e22);color:#fff;font-weight:600;">Submit</button>
    ${switchText}
    <button onclick="cls('accModal')" style="background:linear-gradient(135deg,#f1c40f,#e67e22);color:#fff;font-weight:600;">X</button>
  `;
  accModal.style.display="flex";
}

// Submit account
function subAcc(type){
  const n=document.getElementById("accName").value.trim();
  const p=document.getElementById("accPass").value;
  if(!n)return alert("Enter name");
  db.ref("users/"+n).get().then(s=>{
    if(type=="Create"){
      if(s.exists())return alert("Name taken!");
      me=n;col="#1abc9c";pic="https://th.bing.com/th/id/OIP.Xx93W3aTtFensmWsSFuDYAHaHa?w=202&h=202&c=7&r=0&o=7&dpr=1.3&pid=1.7&rm=3";
      db.ref("users/"+n).set({color:col,password:p||null,myChats:{},friends:{},requests:{},joinTime:Date.now(),pfp:pic});
      startChatUI(); cls('accModal'); cls('startupScreen');
    } else {
      if(!s.exists())return alert("Name not found!");
      const passReq=s.val().password;
      if(passReq && passReq!==p)return alert("Incorrect password!");
      me=n; col=s.val().color||"#1abc9c"; pic=s.val().pfp||pic;
      startChatUI(); cls('accModal'); cls('startupScreen');
    }
  });
}

// Start chat UI
function startChatUI(){
  document.getElementById("chatUI").style.display="flex";
}

<script>
// Send message
function sendMsg(){
  if(!chat)return;
  const txt=document.getElementById("msg").value.trim();
  if(!txt)return;
  document.getElementById("msg").value="";
  db.ref("messages/"+chat).push({u:me,txt:txt,c:col,pic:pic,timestamp:Date.now()});
}

// Send button
document.getElementById("sendBtn").onclick=sendMsg;

// Join chat
function joinChat(code){
  chat=code; chatDiv.innerHTML=""; document.getElementById("msg").style.display="block"; document.getElementById("sendBtn").style.display="inline-block";
  db.ref("chats/"+code+"/members/"+me).get().then(s=>{
    if(!s.exists()) db.ref("messages/"+code).push({txt:`[${code}] ${me} joined`,system:true,timestamp:Date.now()});
    db.ref("chats/"+code+"/members/"+me).set(true);
    listenMsgs();
    listenTyping();
  });
}

// Listen for messages
function listenMsgs(){
  if(listener) db.ref("messages/"+chat).off("child_added",listener);
  listener=db.ref("messages/"+chat).on("child_added",snap=>{
    const d=snap.val();
    const row=document.createElement("div"); row.className="msgRow "+(d.u==me?"me":"them");
    if(d.system){
      const j=document.createElement("div"); j.className="join"; j.textContent=d.txt; row.appendChild(j);
    }else{
      const img=document.createElement("img"); img.className="pfp"; img.src=d.pic||pic;
      const msgdiv=document.createElement("div"); msgdiv.className="bub";
      msgdiv.style.background=d.c?.startsWith("linear-gradient")?d.c:(d.c||"#1abc9c");
      const ndiv=document.createElement("div"); ndiv.className="name"; ndiv.textContent=d.u; msgdiv.appendChild(ndiv);
      const txt=document.createElement("div"); txt.textContent=d.txt; txt.style.fontWeight="bold"; msgdiv.appendChild(txt);
      const tdiv=document.createElement("div"); tdiv.className="time"; tdiv.textContent=new Date(d.timestamp).toLocaleTimeString(); msgdiv.appendChild(tdiv);
      row.appendChild(img); row.appendChild(msgdiv);
    }
    chatDiv.appendChild(row); chatDiv.scrollTop=chatDiv.scrollHeight;
  });
}

// Leave chat
function leaveChat(){
  if(!chat)return;
  if(confirm("Leave this chat?")){
    db.ref("chats/"+chat+"/members/"+me).remove();
    chat=null; chatDiv.innerHTML="";
    document.getElementById("msg").style.display="none";
    document.getElementById("sendBtn").style.display="none";
  }
}

// Typing indicator
document.getElementById("msg").addEventListener("input",()=>{
  if(!chat) return;
  db.ref("typing/"+chat+"/"+me).set(true);
  clearTimeout(typingTimeout);
  typingTimeout=setTimeout(()=>{db.ref("typing/"+chat+"/"+me).remove();},1500);
});

function listenTyping(){
  if(!chat)return;
  db.ref("typing/"+chat).on("value",snap=>{
    const arr=[];
    snap.forEach(s=>{if(s.key!==me) arr.push(s.key);});
    document.getElementById("typingDiv").textContent=arr.length?arr.join(", ")+" is typing...":"";
  });
}

// Account modal settings
function openAccSet(){
  accBox.innerHTML=`
    <h3>Account Settings</h3>
    <div>Username: ${me}</div>
    <input id="chgName" placeholder="Change username">
    <input id="chgPass" type="password" placeholder="Password">
    <div>Pick Color:</div>
  `;
  ["#1abc9c","#3498db","#e74c3c","#f1c40f","#9b59b6"].forEach(c=>{
    accBox.innerHTML+=`<button onclick="setCol('${c}')" style="background:${c};color:#fff;margin:2px;"></button>`;
  });
  if(me==="Nether") ["linear-gradient(45deg,#ff6ec4,#7873f5)","linear-gradient(45deg,#00f260,#0575e6)"].forEach(c=>{
    accBox.innerHTML+=`<button onclick="setCol('${c}')" style="background:${c};color:#fff;margin:2px;"></button>`;
  });
  accBox.innerHTML+=`
    <div style="margin-top:10px;">
      <button onclick="addFriend()">Add Friend</button>
      <button onclick="friendReqs()">Friend Requests</button>
      <button onclick="openDMs()">DMs</button>
      <button onclick="saveAcc()">Save</button>
      <button onclick="cls('accModal')">X</button>
    </div>
  `;
  accModal.style.display="flex";
}

function setCol(c){
  if(c.includes("gradient")&&me!=="Nether") return alert("Not allowed");
  col=c;
  db.ref("users/"+me+"/color").set(c);
}

function saveAcc(){
  const n=chgName.value.trim(), p=chgPass.value.trim();
  if(n) me=n;
  if(p) db.ref("users/"+me+"/password").set(p);
  cls('accModal');
}

// Friends and DMs placeholders
function addFriend(){alert("Add Friend placeholder");}
function friendReqs(){alert("Friend Requests placeholder");}
function openDMs(){document.getElementById("dmsModal").style.display="flex";}

// My chats modal
function openChats(){document.getElementById("chatsModal").style.display="flex";}

// New chat modals
function newChat(){document.getElementById("newModal").style.display="flex";}
function mkChat(){cls('newModal');document.getElementById("mkModal").style.display="flex";}
function jnChat(){cls('newModal');document.getElementById("jnModal").style.display="flex";}

// Create chat
function subMk(){
  const n=document.getElementById("mkName").value.trim();
  if(!n)return;
  const code=Math.floor(10000+Math.random()*89999);
  db.ref("chats/"+code).set({name:n,members:{[me]:true}});
  db.ref("users/"+me+"/myChats/"+code).set(n);
  joinChat(code);
  cls('mkModal');
}

// Join chat
function subJn(){
  const c=document.getElementById("jnCode").value.trim();
  if(!c)return;
  db.ref("chats/"+c).get().then(s=>{
    if(!s.exists()) return alert("Chat not found");
    db.ref("users/"+me+"/myChats/"+c).set(s.val().name);
    joinChat(c);
    cls('jnModal');
  });
}
</script>
</script>
</body>
</html>
