<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Friends Chat</title>
<style>
:root {
  --bg-light: #f5f5f5;
  --text-light: #111;
  --bg-dark: #111;
  --text-dark: #eee;
  --accent1: #1abc9c;
  --accent2: #e67e22;
  --accent3: #3498db;
  --accent4: #9b59b6;
  --accent5: #e74c3c;
  --accent6: #f1c40f;
  --accent7: #2ecc71;
  --accent8: #e84393;
}

body {
  font-family: 'Segoe UI', sans-serif;
  margin:0;
  padding:0;
  background: var(--bg-dark);
  color: var(--text-dark);
}

#startup {
  position: fixed; top:0; left:0; width:100%; height:100%;
  background: var(--bg-dark); display:flex; flex-direction:column; align-items:center; justify-content:center;
  z-index:10;
}

#startup h1 { margin-bottom:20px; }

#startup input, #startup select, #startup button {
  padding:10px;
  margin:5px;
  border-radius:8px;
  border:none;
  font-size:16px;
}

#chatContainer {
  display:none;
  max-width:700px;
  margin:0 auto;
  padding:20px;
}

#chat {
  border:1px solid #444; 
  padding:10px; 
  height:400px; 
  overflow-y:auto; 
  border-radius:12px;
  background: #222;
}

textarea { width:80%; height:50px; padding:10px; border-radius:8px; border:1px solid #555; margin-top:10px; resize:none; }
button { padding:10px 15px; border:none; border-radius:8px; margin-left:5px; cursor:pointer; }

.userBubble {
  background:#1abc9c; 
  color:#fff; 
  padding:8px 12px; 
  border-radius:15px; 
  margin:5px 0; 
  max-width:70%; 
  word-wrap:break-word;
  align-self:flex-end;
}

.friendBubble {
  background:#444; 
  color:#fff; 
  padding:8px 12px; 
  border-radius:15px; 
  margin:5px 0; 
  max-width:70%; 
  word-wrap:break-word;
  align-self:flex-start;
}

.chatMessage {
  display:flex;
  flex-direction:column;
}

#toggleMode { position:absolute; top:10px; right:10px; padding:5px 10px; border-radius:6px; }
</style>
</head>
<body>

<div id="startup">
  <h1>Welcome to Friends Chat!</h1>
  <input type="text" id="nameInput" placeholder="Enter your name" />
  <select id="colorSelect">
    <option value="#1abc9c">Teal</option>
    <option value="#e67e22">Orange</option>
    <option value="#3498db">Blue</option>
    <option value="#9b59b6">Purple</option>
    <option value="#e74c3c">Red</option>
    <option value="#f1c40f">Yellow</option>
    <option value="#2ecc71">Green</option>
    <option value="#e84393">Pink</option>
  </select>
  <div>
    <button onclick="setMode('light')">Light Mode</button>
    <button onclick="setMode('dark')">Dark Mode</button>
  </div>
  <button onclick="startChat()">Join Chat</button>
</div>

<div id="chatContainer">
  <button id="toggleMode" onclick="toggleMode()">Toggle Light/Dark</button>
  <div id="chat"></div>
  <textarea id="msg" placeholder="Type a message..."></textarea>
  <button onclick="send()">Send</button>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

<script>
// ---- Firebase config ----
const firebaseConfig = {
  apiKey: "AIzaSyCSh6K8e_CAswGyYuIvgMVKZ3T8b5gGKFU",
  authDomain: "hyphonchat.firebaseapp.com",
  databaseURL: "https://hyphonchat-default-rtdb.firebaseio.com",
  projectId: "hyphonchat",
  storageBucket: "hyphonchat.firebasestorage.app",
  messagingSenderId: "172774813412",
  appId: "1:172774813412:web:8d307b6a170bf270cfc6f1"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ---- Variables ----
let myName = "";
let myColor = "#1abc9c";
let isDark = true;
const maxMessages = 40;
const chatDiv = document.getElementById("chat");

// ---- Startup / Join ----
function startChat(){
  const nameVal = document.getElementById("nameInput").value.trim();
  myName = nameVal || ("User"+Math.floor(Math.random()*1000));
  myColor = document.getElementById("colorSelect").value;
  document.getElementById("startup").style.display="none";
  document.getElementById("chatContainer").style.display="block";
  listenMessages();
}

// ---- Light/Dark Mode ----
function setMode(mode){
  isDark = mode==="dark";
  document.body.style.background = isDark ? "#111" : "#f5f5f5";
  document.body.style.color = isDark ? "#eee" : "#111";
  document.getElementById("chat").style.background = isDark ? "#222" : "#ddd";
}
function toggleMode(){ setMode(isDark?"light":"dark"); }

// ---- Listen for messages ----
function listenMessages(){
  db.ref("messages").on("child_added", snap=>{
    const data = snap.val();
    addLine(data.user, data.text, data.color, data.user===myName);
    pruneMessages();
  });
}

// ---- Add message ----
function addLine(user,text,color,isMe){
  const wrapper = document.createElement("div");
  wrapper.className="chatMessage";
  const bubble = document.createElement("div");
  bubble.textContent = user+": "+text;
  bubble.style.background = isMe? color : "#444";
  bubble.style.color = "#fff";
  bubble.className = isMe? "userBubble":"friendBubble";
  wrapper.appendChild(bubble);
  chatDiv.appendChild(wrapper);
  chatDiv.scrollTop = 99999;
}

// ---- Send message ----
function send(){
  const msg = document.getElementById("msg").value.trim();
  if(!msg) return;
  db.ref("messages").push({ user: myName, text: msg, color: myColor });
  document.getElementById("msg").value="";
}

// ---- Delete messages past limit ----
function pruneMessages(){
  db.ref("messages").once("value").then(snap=>{
    if(snap.numChildren()>maxMessages){
      const msgs = snap.val();
      const keys = Object.keys(msgs).sort(); // oldest first
      const toDelete = keys.slice(0, snap.numChildren()-maxMessages);
      toDelete.forEach(k=>db.ref("messages/"+k).remove());
    }
  });
}

// ---- Optional: set initial mode ----
setMode("dark");
</script>

</body>
</html>
