<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Hyphon Chat</title>
<style>
body{margin:0;font-family:sans-serif;background:#111;color:#fff;}
header{background:#222;padding:8px;display:flex;gap:8px;position:fixed;top:0;left:0;right:0;z-index:100;}
header button{padding:8px 12px;border:none;border-radius:6px;color:#fff;font-weight:600;
  background:linear-gradient(135deg,#f39c12,#e67e22);cursor:pointer;}
#chatUI{margin-top:60px;display:none;}
#chatContainer{display:flex;flex-direction:column;height:calc(100vh - 60px);}
#chat{flex:1;overflow-y:auto;padding:12px;scroll-behavior:smooth;}
.messageRow{display:flex;align-items:flex-end;margin:6px 0;max-width:80%;}
.messageRow.right{margin-left:auto;flex-direction:row-reverse;}
.messageRow img{width:32px;height:32px;border-radius:50%;margin:0 6px;}
.msgBubble{padding:8px 12px;border-radius:12px;word-wrap:break-word;max-width:260px;}
.msgBubble.left{background:#333;}
.msgBubble.right{background:#2980b9;}
.username{font-size:12px;color:#bbb;margin:0 6px;}
.sysMsg{color:#aaa;font-size:13px;margin:6px 0;}
#msg{resize:none;padding:10px;border:none;outline:none;font-weight:bold;border-radius:6px;
 background:linear-gradient(135deg,#3498db,#2980b9);color:#fff;}
#sendBtn{margin-top:4px;padding:8px 12px;border:none;border-radius:6px;color:#fff;font-weight:600;
 background:linear-gradient(135deg,#f39c12,#e67e22);cursor:pointer;}
.modal{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.6);
  display:flex;align-items:center;justify-content:center;z-index:200;}
.modalContent{background:linear-gradient(135deg,#3498db,#2980b9);padding:20px;border-radius:10px;color:#fff;}
#startupScreen{position:fixed;top:0;left:0;right:0;bottom:0;
 background:linear-gradient(135deg,#3498db,#2980b9);display:flex;flex-direction:column;
 align-items:center;justify-content:center;z-index:999;}
#startupScreen h1{font-size:28px;margin-bottom:20px;}
#startupScreen button{padding:12px 20px;border:none;border-radius:8px;font-weight:600;color:#fff;
 background:linear-gradient(135deg,#f39c12,#e67e22);cursor:pointer;}
</style>
</head>
<body>

<!-- Startup -->
<div id="startupScreen">
  <h1>Welcome to Hyphon Chat</h1>
  <button onclick="accUI('Create')">Sign Up for Free</button>
  <div style="margin-top:12px;">
    <a href="#" style="color:#fff;" onclick="accUI('Login')">Already have an account? Log in</a>
  </div>
</div>

<header>
  <button onclick="accUI()">Account</button>
  <button onclick="opn('chatsModal')">My Chats</button>
  <button onclick="opn('newModal')">New Chat</button>
  <button onclick="leaveChat()">Leave Chat</button>
  <button onclick="opn('dmsModal')">DMs</button>
</header>

<div id="chatUI">
  <div id="chatContainer">
    <div id="chat"></div>
    <textarea id="msg" placeholder="Type..."></textarea>
    <button id="sendBtn" onclick="sendMsg()">Send</button>
    <div id="typingDiv" style="font-size:12px;color:#aaa;margin-top:4px;"></div>
  </div>
</div>

<!-- Modals -->
<div id="accModal" class="modal"><div class="modalContent" id="accBox"></div></div>
<div id="chatsModal" class="modal"><div class="modalContent"><h3>My Chats</h3><div id="chatList"></div><button onclick="cls('chatsModal')">X</button></div></div>
<div id="newModal" class="modal"><div class="modalContent"><button onclick="mkChat()">Create Chat</button><button onclick="jnChat()">Join Chat</button><button onclick="cls('newModal')">X</button></div></div>
<div id="mkModal" class="modal"><div class="modalContent"><input id="mkName" placeholder="Chat name"><button onclick="subMk()">Go</button><button onclick="cls('mkModal')">X</button></div></div>
<div id="jnModal" class="modal"><div class="modalContent"><input id="jnCode" placeholder="Chat code"><button onclick="subJn()">Go</button><button onclick="cls('jnModal')">X</button></div></div>
<div id="friendReqModal" class="modal"><div class="modalContent"><h3>Friend Requests</h3><div id="friendRequests"></div><button onclick="cls('friendReqModal')">X</button></div></div>
<div id="dmsModal" class="modal"><div class="modalContent"><h3>DMs</h3><div id="dmsList"></div><button onclick="cls('dmsModal')">X</button></div></div>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script>
const fb={apiKey:"AIzaSyCSh6K8e_CAswGyYuIvgMVKZ3T8b5gGKFU",authDomain:"hyphonchat.firebaseapp.com",databaseURL:"https://hyphonchat-default-rtdb.firebaseio.com",projectId:"hyphonchat",storageBucket:"hyphonchat.firebasestorage.app",messagingSenderId:"172774813412",appId:"1:172774813412:web:8d307b6a170bf270cfc6f1"};
firebase.initializeApp(fb);
const db=firebase.database();

let user=null,chatId=null,chatNum=0;

// --- Account UI ---
function accUI(type){
  let box=document.getElementById("accBox");
  let modal=document.getElementById("accModal");
  if(type==="Login"||type==="Create"){
    box.innerHTML=`<h3>${type} Account</h3>
      <input id="accUser" placeholder="Username"><br><br>
      <button onclick="login('${type}')">${type}</button>
      <button onclick="cls('accModal')">X</button>`;
    modal.style.display="flex";
    return;
  }
  // else show settings
  box.innerHTML=`
    <h3>Account Settings</h3>
    <div><img src="${user?.pfp||'https://th.bing.com/th/id/OIP.Xx93W3aTtFensmWsSFuDYAHaHa?w=202&h=202'}" width=64 height=64 style="border-radius:50%"></div>
    <p>Username: ${user?.name||''}</p>
    <label>Change Username:</label><input id="newU"><button onclick="chgName()">Save</button><br>
    <label>Profile Pic URL:</label><input id="newP"><button onclick="chgPfp()">Save</button><br>
    <label>Msg Color:</label><input id="newC" type="color" value="${user?.color||'#3498db'}"><button onclick="chgCol()">Save</button><br>
    <button onclick="opn('friendReqModal')">Friend Requests</button>
    <button onclick="opn('dmsModal')">DMs</button>
    <button onclick="logout()">Logout</button>
    <button onclick="cls('accModal')">X</button>`;
  modal.style.display="flex";
}

// --- Login/Create ---
function login(type){
  let name=document.getElementById("accUser").value.trim();
  if(!name) return;
  user={name,pfp:"https://th.bing.com/th/id/OIP.Xx93W3aTtFensmWsSFuDYAHaHa?w=202&h=202",color:"#3498db"};
  localStorage.setItem("hyphonUser",JSON.stringify(user));
  document.getElementById("accModal").style.display="none";
  document.getElementById("startupScreen").style.display="none";
  document.getElementById("chatUI").style.display="block";
}

// --- Message Send ---
function sendMsg(){
  if(!chatId) return;
  let text=document.getElementById("msg").value.trim();
  if(!text) return;
  let ref=db.ref("chats/"+chatId+"/msgs").push();
  ref.set({u:user.name,t:text,c:user.color,p:user.pfp||"",time:Date.now()});
  document.getElementById("msg").value="";
}

// --- Load Messages ---
function loadMsgs(){
  if(!chatId) return;
  let ref=db.ref("chats/"+chatId+"/msgs");
  ref.off();
  ref.on("child_added",snap=>{
    let m=snap.val();
    let div=document.createElement("div");
    if(m.sys){
      div.className="sysMsg";
      div.innerText=m.t;
    }else{
      let row=document.createElement("div");
      row.className="messageRow "+(m.u===user.name?"right":"left");
      let img=document.createElement("img");
      img.src=m.p||"https://th.bing.com/th/id/OIP.Xx93W3aTtFensmWsSFuDYAHaHa?w=202&h=202";
      let name=document.createElement("div");
      name.className="username";
      name.innerText=m.u;
      let bubble=document.createElement("div");
      bubble.className="msgBubble "+(m.u===user.name?"right":"left");
      if(m.u==="Nether") bubble.style.background="linear-gradient(135deg,#8e44ad,#3498db)";
      else bubble.style.background=m.c||"#333";
      bubble.innerText=m.t;
      row.appendChild(img);
      row.appendChild(name);
      row.appendChild(bubble);
      div.appendChild(row);
    }
    document.getElementById("chat").appendChild(div);
    document.getElementById("chat").scrollTop=999999;
  });
}

// --- Chats ---
function mkChat(){cls('newModal');opn('mkModal');}
function subMk(){
  let n=document.getElementById("mkName").value.trim();if(!n) return;
  let ref=db.ref("chats").push();
  chatId=ref.key;chatNum++;
  ref.set({name:n,msgs:{}});
  db.ref("chats/"+chatId+"/msgs").push({sys:true,t:"["+chatNum+"] "+user.name+" Joined"});
  cls("mkModal");document.getElementById("chatUI").style.display="block";loadMsgs();
}
function jnChat(){cls('newModal');opn('jnModal');}
function subJn(){
  let code=document.getElementById("jnCode").value.trim();if(!code) return;
  chatId=code;chatNum++;
  db.ref("chats/"+chatId+"/msgs").push({sys:true,t:"["+chatNum+"] "+user.name+" Joined"});
  cls("jnModal");document.getElementById("chatUI").style.display="block";loadMsgs();
}
function leaveChat(){chatId=null;document.getElementById("chat").innerHTML="";}

// --- Account changes ---
function chgName(){let v=document.getElementById("newU").value;if(v){user.name=v;localStorage.setItem("hyphonUser",JSON.stringify(user));accUI();}}
function chgPfp(){let v=document.getElementById("newP").value;if(v){user.pfp=v;localStorage.setItem("hyphonUser",JSON.stringify(user));accUI();}}
function chgCol(){let v=document.getElementById("newC").value;if(v&&user.name!=="Nether"){user.color=v;localStorage.setItem("hyphonUser",JSON.stringify(user));accUI();}}
function logout(){localStorage.removeItem("hyphonUser");location.reload();}

// --- Utils ---
function opn(id){document.getElementById(id).style.display="flex";}
function cls(id){document.getElementById(id).style.display="none";}

// Auto-login
let s=localStorage.getItem("hyphonUser");if(s){user=JSON.parse(s);document.getElementById("startupScreen").style.display="none";document.getElementById("chatUI").style.display="block";}
</script>
</body>
</html>

