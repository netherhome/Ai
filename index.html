<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Hyphon Chat</title>
<style>
body{margin:0;font-family:sans-serif;background:#111;color:#fff;}
header{position:fixed;top:0;left:0;right:0;display:flex;gap:6px;background:#222;padding:8px;z-index:10;}
header button{padding:6px 12px;border:none;border-radius:8px;color:#fff;font-weight:bold;
background:linear-gradient(135deg,#f1c40f,#e67e22);}
#chatUI{margin-top:60px;padding:10px;height:calc(100vh - 60px);overflow:hidden;display:flex;flex-direction:column;}
#chat{flex:1;overflow-y:auto;padding-right:8px;scroll-behavior:smooth;}
.msg{max-width:60%;margin:6px;padding:8px 12px;border-radius:12px;position:relative;word-wrap:break-word;}
.msg.me{margin-left:auto;background:#3498db;color:#fff;text-align:left;}
.msg.other{margin-right:auto;background:#444;}
.msg img{width:28px;height:28px;border-radius:50%;vertical-align:middle;margin-right:6px;}
.msg span.user{font-weight:bold;margin-right:4px;}
textarea#msg{resize:none;padding:8px;border-radius:8px;width:100%;margin-top:6px;
background:linear-gradient(135deg,#2980b9,#3498db);color:#fff;font-weight:bold;}
#sendBtn{margin-top:4px;padding:8px;border:none;border-radius:8px;color:#fff;
background:linear-gradient(135deg,#f1c40f,#e67e22);}
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.7);
align-items:center;justify-content:center;z-index:20;}
.modalContent{background:linear-gradient(135deg,#2980b9,#3498db);padding:20px;border-radius:12px;max-height:80%;overflow:auto;}
#startupScreen{position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg,#2980b9,#3498db);
display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:30;}
#startupScreen h1{margin-bottom:20px;}
#startupScreen button{padding:12px 20px;margin:6px;border:none;border-radius:12px;font-weight:bold;
background:linear-gradient(135deg,#f1c40f,#e67e22);color:#fff;}
</style>
</head>
<body>

<!-- Startup Screen -->
<div id="startupScreen">
  <h1>Welcome to Hyphon Chat</h1>
  <div>
    <button onclick="startAcc('Create')">Sign Up for Free</button>
    <br>
    <button onclick="startAcc('Login')">Already have an account? Log In</button>
  </div>
</div>

<header>
  <div>
    <button id="accBtn" onclick="accUI('Settings')">Account</button>
    <button id="chatsBtn" onclick="opn('chatsModal')">My Chats</button>
    <button id="newChatBtn" onclick="opn('newModal')">New Chat</button>
    <button id="leaveBtn" onclick="leaveChat()">Leave Chat</button>
    <button id="dmsBtn" onclick="opn('dmsModal')">DMs</button>
  </div>
</header>

<div id="chatUI">
  <div id="chat"></div>
  <textarea id="msg" placeholder="Type..."></textarea>
  <button id="sendBtn" onclick="sendMsg()">Send</button>
  <div id="typingDiv" style="font-size:12px;color:#aaa;margin-top:4px;"></div>
</div>

<!-- Modals -->
<div id="accModal" class="modal"><div class="modalContent" id="accBox"></div></div>
<div id="chatsModal" class="modal"><div class="modalContent"><h3>My Chats</h3><div id="chatList"></div><button onclick="cls('chatsModal')">X</button></div></div>
<div id="newModal" class="modal"><div class="modalContent"><button onclick="mkChat()">Create Chat</button><button onclick="jnChat()">Join Chat</button><button onclick="cls('newModal')">X</button></div></div>
<div id="mkModal" class="modal"><div class="modalContent"><input id="mkName" placeholder="Chat name"><button onclick="subMk()">Go</button><button onclick="cls('mkModal')">X</button></div></div>
<div id="jnModal" class="modal"><div class="modalContent"><input id="jnCode" placeholder="Chat code"><button onclick="subJn()">Go</button><button onclick="cls('jnModal')">X</button></div></div>
<div id="friendReqModal" class="modal"><div class="modalContent"><h3>Friend Requests</h3><div id="friendRequests"></div><button onclick="cls('friendReqModal')">X</button></div></div>
<div id="dmsModal" class="modal"><div class="modalContent"><h3>DMs</h3><div id="dmsList"></div><button onclick="cls('dmsModal')">X</button></div></div>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script>
// Firebase
const fb={apiKey:"AIzaSyCSh6K8e_CAswGyYuIvgMVKZ3T8b5gGKFU",authDomain:"hyphonchat.firebaseapp.com",databaseURL:"https://hyphonchat-default-rtdb.firebaseio.com",projectId:"hyphonchat",storageBucket:"hyphonchat.firebasestorage.app",messagingSenderId:"172774813412",appId:"1:172774813412:web:8d307b6a170bf270cfc6f1"};
firebase.initializeApp(fb);
const db=firebase.database();

let me=null,myColor="#3498db",myPfp="",curChat=null;

// --- Account UI ---
function startAcc(type){
  document.getElementById("startupScreen").style.display="none"; // hide startup first
  accUI(type);
}

function accUI(type){
  let box=document.getElementById("accBox");
  let modal=document.getElementById("accModal");

  if(type==="Create"){ // Sign Up
    box.innerHTML=`
      <h3>Create Account</h3>
      <input id="newName" placeholder="Username"><br>
      <input id="newPass" type="password" placeholder="Password"><br>
      <button onclick="doCreate()">Create</button>
      <button onclick="cls('accModal')">X</button>`;
    modal.style.display="flex";
    return;
  }

  if(type==="Login"){ // Log In
    box.innerHTML=`
      <h3>Log In</h3>
      <input id="logName" placeholder="Username"><br>
      <input id="logPass" type="password" placeholder="Password"><br>
      <button onclick="doLogin()">Log In</button>
      <button onclick="cls('accModal')">X</button>`;
    modal.style.display="flex";
    return;
  }

  if(type==="Settings" && me){ // Account Settings
    box.innerHTML=`
      <h3>Account Settings</h3>
      <div><img src="${myPfp||'https://th.bing.com/th/id/OIP.Xx93W3aTtFensmWsSFuDYAHaHa?w=202&h=202'}" width=64 height=64 style="border-radius:50%"></div>
      <p>Username: ${me}</p>
      <label>Change Username:</label><input id="newU"><button onclick="chgName()">Save</button><br>
      <label>Profile Pic URL:</label><input id="newPfp"><button onclick="chgPfp()">Save</button><br>
      <label>Msg Color:</label><input id="newC" type="color" value="${myColor||'#3498db'}"><button onclick="chgCol()">Save</button><br>
      <button onclick="opn('friendReqModal')">Friend Requests</button>
      <button onclick="opn('dmsModal')">DMs</button>
      <button onclick="sendFriendReq()">Friend Someone</button>
      <button onclick="logout()">Logout</button>
      <button onclick="cls('accModal')">X</button>`;
    modal.style.display="flex";
    return;
  }
}

// --- Utilities ---
function opn(id){document.getElementById(id).style.display="flex";}
function cls(id){document.getElementById(id).style.display="none";}

// --- Placeholder account functions ---
function doCreate(){alert("Sign up logic here");me=document.getElementById("newName").value;cls('accModal');}
function doLogin(){alert("Login logic here");me=document.getElementById("logName").value;cls('accModal');}
function logout(){me=null;alert("Logged out");}
function chgName(){alert("Changed name");}
function chgPfp(){alert("Changed PFP");}
function chgCol(){alert("Changed color");}
function sendFriendReq(){alert("Send friend request logic here");}

// --- Chats ---
function mkChat(){opn('mkModal');}
function jnChat(){opn('jnModal');}
function subMk(){alert("Chat created");cls('mkModal');}
function subJn(){alert("Joined chat");cls('jnModal');}
function leaveChat(){alert("Left chat");}

// --- Messages ---
function sendMsg(){
  let val=document.getElementById("msg").value;
  if(!val) return;
  let chat=document.getElementById("chat");
  let d=document.createElement("div");
  d.className="msg me";
  d.innerHTML=`<img src="${myPfp||'https://th.bing.com/th/id/OIP.Xx93W3aTtFensmWsSFuDYAHaHa?w=202&h=202'}"><span class="user">${me}</span> ${val}`;
  chat.appendChild(d);
  document.getElementById("msg").value="";
  chat.scrollTop=chat.scrollHeight;
}
</script>
</body>
</html>
